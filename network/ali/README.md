# 阿里云网络产品梳理及共有云化方案
---

## 需求梳理：
- 减少迁移对服务的影响及损失
- 迁移过程中的带宽保障（广域及局域）
- 网络的灵活性、健壮性、安全性、隔离性

## 问题梳理：
- IP地址变化
- 地址资源的管理，IP地址的规划，按照CIDR进行规划和计算，流量包计费公式和使用场景计算
- 迁移时出口IP变化，DNS解析缓存问题
- VPC的网络规划
- 可使用阿里云产品，但不能依赖
- 经典网络到VPC迁移的方案
- SLB混挂的问题，是只在VPC侧的SLB支持混挂吗？

## 阿里云网络产品梳理
- 专有网络VPC
- 负载均衡
- NAT网关
- 弹性公网IP
- 高速通道
- 全球加速
- 共享流量包
- 共享带宽
- 云企网
- 云托付
- Ipv6转换服务
- 智能接入网关
- VPN网关
- 云解析PrivateZone

## 专有网络VPC
- 背景：
随着云计算的不断发展，对虚拟化网络的要求越来越高，比如弹性（scalability）、安全性（security）、可靠性（reliability）和私密性（privacy），并且还有极高的互联性能（performance）需求，因此催生了多种多样的网络虚拟化技术。
比较早的解决方案，是将虚拟机的网络和物理网络融合在一起，形成一个扁平的网络架构，例如大二层网络。随着虚拟化网络规模的扩大，这种方案中的ARP欺骗、广播风暴、主机扫描等问题会越来越严重。为了解决这些问题，出现了各种网络隔离技术，把物理网络和虚拟网络彻底隔开。其中一种技术是用户之间用VLAN进行隔离，但是VLAN的数量最大只能支持到4096个，无法支撑公共云的巨大用户量。

- 原理：
基于目前主流的隧道技术，专有网络（Virtual Private Cloud，简称VPC）隔离了虚拟网络。每个VPC都有一个独立的隧道号，一个隧道号对应着一个虚拟化网络。一个VPC内的ECS（Elastic Compute Service）实例之间的传输数据包都会加上隧道封装，带有唯一的隧道ID标识，然后送到物理网络上进行传输。不同VPC内的ECS实例因为所在的隧道ID不同，本身处于两个不同的路由平面，所以不同VPC内的ECS实例无法进行通信，天然地进行了隔离。基于隧道技术和软件定义网络（Software Defined Network，简称SDN）技术，阿里云的研发在硬件网关和自研交换机设备的基础上实现了VPC产品。

- 基础知识：
专有网络VPC（Virtual Private Cloud）是用户基于阿里云创建的自定义私有网络, **不同的专有网络之间二层逻辑隔离**，用户可以在自己创建的专有网络内创建和管理云产品实例，比如ECS、负载均衡、RDS等。
![](/assets/vpc.png)

- 网络组成：
每个VPC都由一个私网网段、一个路由器和至少一个交换机组成。在创建专有网络和交换机时，您需要以CIDR地址块的形式指定专有网络使用的私网网段。
![](/assets/vpc-range.png)

- 路由器
路由器（VRouter）是专有网络的枢纽。作为专有网络中重要的功能组件，它可以连接VPC内的各个交换机，同时也是连接VPC和其他网络的网关设备。每个专有网络创建成功后，系统会自动创建一个路由器。每个路由器关联一张路由表。更多信息参见路由。

- 交换机
交换机（VSwitch）是组成专有网络的基础网络设备，用来连接不同的云产品实例。创建专有网络之后，您可以通过创建交换机为专有网络划分一个或多个子网。同一专有网络内的不同交换机之间内网互通。您可以将应用部署在不同可用区的交换机内，提高应用的可用性，更多信息参见管理交换机。

- VPC连接
阿里云提供了丰富的解决方案以满足VPC内的云产品实例与Internet、其他VPC、或本地数据中心（IDC）互连的需求。
![](/assets/vpc_internet.png)
![](/assets/vpc_vpc.png)
![](/assets/vpc_idc.png)

- 安全
每个VPC都有一个独立的隧道号，一个隧道号对应着一个虚拟化网络。专有网络之间通过隧道ID进行隔离：
专有网络内部由于交换机和路由器的存在，所以可以像传统网络环境一样划分子网，每一个子网内部的不同云服务器使用同一个交换机互联，不同子网间使用路由器互联。
不同专有网络之间内部网络完全隔离，只能通过对外映射的IP（弹性公网IP和NAT IP）互联。
由于使用隧道封装技术对云服务器的IP报文进行封装，所以云服务器的数据链路层（二层MAC地址）信息不会进入物理网络，实现了不同云服务器间二层网络隔离，因此也实现了不同专有网络间二层网络隔离。
专有网络内的ECS使用安全组防火墙进行三层网络访问控制。

- 可控
您可以通过安全组规则、访问控制白名单等方式灵活地控制访问专有网络内云资源的出入流量。

- 易用
您可以通过专有网络控制台快速创建、管理专有网络。专有网络创建后，系统会自动为其创建一个路由器和路由表。

- 可扩展性
您可以在一个专有网络内创建不同的子网，部署不同的业务。此外，您可以将一个VPC和本地数据中心或其他VPC相连，扩展网络架构。

- 应用场景
  - 托管应用程序
  ![](/assets/tuo_guan.png)
  - 托管主动访问公网的应用程序
  ![](/assets/tuo_guan_active.png)
  - 跨可用区容灾
  ![](/assets/vpc_ha.png)
  - 业务隔离（对等互联要收取费用）
  ![](/assets/vpc_geli.png)
  - 混合云
  ![](/assets/vpc_hunhe.png)
  - 多应用流量波动大
  ![](/assets/vpc_duoyingyong.png)
  
- 使用限制
![](/assets/vpc_limit.png)

- 创建专有网络
  - VPC目标网段：
    选择VPC的网段。VPC的网段限制如下：
    您可以使用192.168.0.0/16、172.16.0.0/12和10.0.0.0/8这三个标准网段或其子集。如果要使用标准网段的子网作为VPC的网段，需要使用API创建VPC。
    如果有多个VPC，或者VPC和本地数据中心互连构建混合云的需求，建议使用上面这些标准网段的子网作为VPC的网段，掩码建议不超过/16。
    如果云上只有一个VPC并且不需要和本地数据中心互通，那么选择以上任何一个网段或其子网。
  - 交换机目标网段：
    交换机的网段可以和其所属的VPC网段相同或者是其VPC网段的子集。
    例如，VPC的网段是192.168.0.0/16，那么该VPC内的交换机的网段可以是192.168.0.0/16，也可以是192.168.0.0/17，一直到192.168.0.0/29。
    说明 如果交换机的网段和专有网络的网段相同，您只能创建一个交换机。
    交换机的网段的大小在16位网络掩码与29位网络掩码之间，可提供8-65536个地址。
    每个交换机的第一个和最后三个IP地址为系统保留地址。
    以192.168.1.0/24为例，192.168.1.0、 192.168.1.253、 192.168.1.254和192.168.1.255这些地址是系统保留地址。
    如果该交换机有和其他专有网络的交换机，或本地数据中心通信的需求，确保交换机的网段和要通信的网段不冲突。
    ![](/assets/vpc-idc.png)
    
- SLB的混挂混访
https://help.aliyun.com/document_detail/57946.html?spm=a2c4g.11186623.6.581.6ff07e88XpiJLW